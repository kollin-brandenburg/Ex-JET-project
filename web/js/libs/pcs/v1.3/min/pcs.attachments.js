/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*
 RequireJS i18n 2.0.2 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details
*/

define("text",["module"],function(e){"use strict";var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.12",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}d.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("ï»¿")===0&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!pcs/attachments/templates/pcs-attachments.html",[],function(){return"<div data-bind='component: {\n    name: \"attachmentComponent\",\n	params : {data : data}\n}'></div>\n"}),function(){function e(e,t,n,r,i,s){return t[e]||(e=e.replace(/^zh-(Hans|Hant)-([^-]+)$/,"zh-$2")),t[e]?(n.push(e),!0!==t[e]&&1!==t[e]||r.push(i+e+"/"+s),!0):!1}function t(e){var t=e.toLowerCase().split(/-|_/);e=[t[0]];var n=1,r;for(r=1;r<t.length;r++){var i=t[r],s=i.length;if(1==s)break;switch(n){case 1:if(n=2,4==s){e.push(i.charAt(0).toUpperCase()+i.slice(1));break};case 2:n=3,e.push(i.toUpperCase());break;default:e.push(i)}}if(!("zh"!=e[0]||1<e.length&&4==e[1].length)){t="Hans",n=1<e.length?e[1]:null;if("TW"===n||"MO"===n||"HK"===n)t="Hant";e.splice(1,0,t)}return e}function n(e,t){for(var r in t)t.hasOwnProperty(r)&&(null==e[r]?e[r]=t[r]:"object"==typeof t[r]&&"object"==typeof e[r]&&n(e[r],t[r]))}var r=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("ojL10n",["module"],function(i){var s=i.config?i.config():{};return{version:"2.0.1+",load:function(i,o,u,a){a=a||{},a.locale&&(s.locale=a.locale);var f=r.exec(i),l=f[1],c,h=f[5],p,d=[],v={},m,g="",w,E,S,T,N,C;f[5]?(l=f[1],i=l+h,c=f[4]):(h=f[4],c=s.locale,"undefined"!=typeof document?(c||(c=a.isBuild?"root":document.documentElement.lang)||(c=void 0===navigator?"root":navigator.language||navigator.userLanguage||"root"),s.locale=c):c="root"),p=t(c),w=s.noOverlay,E=s.defaultNoOverlayLocale;if(f=s.merge)if(S=f[l+h])f=r.exec(S),T=f[1],N=f[4];C=[];for(m=0;m<p.length;m++)f=p[m],g+=(g?"-":"")+f,C.push(g);a.isBuild?(d.push(i),S&&d.push(S),o(d,function(){u()})):("query"==s.includeLocale&&(i=o.toUrl(i+".js"),i+=(-1===i.indexOf("?")?"?":"&")+"loc="+c),a=[i],S&&a.push(S),o(a,function(t,r){var i=[],s,a=!1,f=w||!0===t.__noOverlay,c=E||t.__defaultNoOverlayLocale;for(m=C.length-1;0<=m&&(!a||!f);m--)a=e(C[m],t,i,d,l,h);f&&!a&&c&&e(c,t,i,d,l,h),e("root",t,i,d,l,h),s=i.length;if(r){a=!1,f=!0===r.__noOverlay,c=r.__defaultNoOverlayLocale;for(m=C.length-1;0<=m&&(!a||!f);m--)a=e(C[m],r,i,d,T,N);f&&!a&&c&&e(c,r,i,d,T,N),e("root",r,i,d,T,N)}o(d,function(){var e,a,f;for(e=s;e<i.length&&i[e];e++){f=i[e],a=r[f];if(!0===a||1===a)a=o(T+f+"/"+N);n(v,a)}for(e=0;e<s&&i[e];e++){f=i[e],a=t[f];if(!0===a||1===a)a=o(l+f+"/"+h);n(v,a)}v._ojLocale_=p.join("-"),u(v)})}))}}})}(),define("pcs/util/pcsUtil",["module","knockout","ojs/ojcore","jquery"],function(e,t,n,r){"use strict";function a(){var e={},t;if(window.location.href.indexOf("?")===-1)return e;var n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var r=0;r<n.length;r++){t=n[r].split("=");var i=decodeURIComponent(t[0]),s=decodeURIComponent(t[1]),o=JSON.parse(s);e[i]=o}return e}var i={};r.CustomEvent=function(e){var t,n=e&&i[e];return n||(t=r.Callbacks(),n={publish:t.fire,subscribe:t.add,unsubscribe:t.remove},e&&(i[e]=n)),n};var s={addHandler:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},removeHandler:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}};String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,value:function(e,t){return t=t||0,this.substr(t,e.length)===e}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{enumerable:!1,value:function(e,t){var n=this.toString();if(typeof t!="number"||!isFinite(t)||Math.floor(t)!==t||t>n.length)t=n.length;t-=e.length;var r=n.indexOf(e,t);return r!==-1&&r===t}});var o=function(e){typeof window.doADFProxyCall=="function"?window.doADFProxyCall(e):e&&window.location.assign(e)},u=function(e){function a(e){var t=e.split("\r\n"),n="text/plain",r="pcsFormUrl",i={contentType:n,fieldName:r};for(var s=1;s<t.length;s++){var o=t[s],u=o.match(/^.*filename="([^"]*)"/);if(u)i.fieldName=u[1];else{var a="Content-Type:";o.indexOf(a)>-1&&(u=o.substring(o.indexOf(a)+a.length)),u&&(i.contentType=u.trim())}}return i}var t=e.getResponseHeader("Content-Type"),n=e.response,r=t.match(/boundary=(?:'([^']+)'|([^;]+))/i);if(!r)throw new Error("Bad content-type header, no multipart boundary");var i=r[1]||r[2],s=typeof n!="string",o,u;i="\r\n--"+i;if(s){var f=new Uint8Array(n),l=32768,c=[];for(u=0;u<f.length;u+=l)c.push(String.fromCharCode.apply(null,f.subarray(u,u+l)));o=c.join("")}else o=n;o="\r\n"+o;var h=o.split(new RegExp(i)),p={};for(u=1;u<h.length-1;u++){var d="\r\n\r\n",v=h[u].substring(h[u].indexOf(d)+d.length),m=h[u].substring(0,h[u].indexOf(d)),g=a(m),y=!1;s&&!g.contentType.startsWith("text")&&(y=!0),p[g.fieldName]={data:v,contentType:g.contentType,fileName:g.fieldName}}return p},f=function(e){return r.ajax({type:"GET",url:e,dataType:"text",xhrFields:{withCredentials:!0}})};return t.bindingHandlers.formatDateInMillis={update:function(e,r,i){var s=t.unwrap(r());if(!s)return;var o={formatType:"date",pattern:i().datePattern},u=n.Validation.converterFactory("datetime").createConverter(o),a=u.format(n.IntlConverterUtils.dateToLocalIso(new Date(s)));t.bindingHandlers.text.update(e,function(){return a})}},{adfProxyCall:o,getAuthToken:f,multipartParse:u,getUrlParametersObject:a,eventHandler:s,initComponentForIFrame:function(e,t,n){if(!r.isEmptyObject(r.pcsConnection))t();else{r.pcsConnection={};if(!r.isEmptyObject(e)){e.testMode&&(r.pcsConnection.testMode=e.testMode),e.serverURL&&(r.pcsConnection.serverURL=e.serverURL);if(e.authInfo){r.pcsConnection.authInfo=e.authInfo,t();return}}var i=this,s=function(){var e=i.getServerURL();console.log("Script loaded and ready, getting token"),i.getAuthToken(e+"/bpm/workspace/auth/token").done(function(e){e&&e.startsWith("<html")?n.text("User cannot be authorized").show():(r.pcsConnection.authInfo="Bearer "+e,t())}).fail(function(e){n.text("User cannot be authorized").show()})},o=document.createElement("script");o.onload=s,o.onreadystatechange=function(){this.readyState==="complete"&&s()};var u=this.getServerURL();o.src=u+"/bpm/workspace/faces/js/homePage.js",document.getElementsByTagName("head")[0].appendChild(o)}},getCookie:function(e){var t;return(t=(new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)")).exec(document.cookie))?t[1]:null},getServerURL:function(){if(r.pcsConnection&&r.pcsConnection.serverURL)return r.pcsConnection.serverURL.endsWith("/")?r.pcsConnection.serverURL.substring(0,r.pcsConnection.serverURL.length-1):r.pcsConnection.serverURL;if(e.uri.indexOf(".")===0||e.uri.indexOf("/")===0)return window.location.origin;try{return(new URL(e.uri)).origin}catch(t){return window.location.origin}},getRestUri:function(){return"/bpm/api/3.0/"},getAuthInfo:function(){if(r.pcsConnection&&r.pcsConnection.authInfo){var e=r.pcsConnection.authInfo;return!e.startsWith("Bearer ")&&!e.startsWith("Basic ")&&(e="Bearer "+e),e}return""},getRestURL:function(){if(r.pcsConnection&&r.pcsConnection.restURL)return r.pcsConnection.restURL;var e=this.getServerURL()+this.getRestUri();return r.pcsConnection&&(r.pcsConnection.restURL=e),e},isTestMode:function(){return r.pcsConnection&&r.pcsConnection.testMode?!0:!1},taskIconColor:function(e){if(!e)return"grey";var t=0,n,r,i;for(n=0,i=e.length;n<i;n++)r=e.charCodeAt(n),t=(t<<5)-t+r,t|=0;var s=t,o=s&255;s>>=8;var u=s&255;s>>=8;var a=s&255;return"rgb("+a+","+u+","+o+")"},taskInitials:function(e){if(!e)return"NA";e=e.replace(" ","");var t=e.charAt(0).toUpperCase(),n="";for(var r=1;r<e.length;r++)if(e.charAt(r)===e.charAt(r).toUpperCase()){n=e.charAt(r);break}return t+n},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},unApplyBindings:function(e,n){e.find("*").each(function(){r(this).off(),r(this).unbind()}),e.off(),n?(t.cleanNode(e[0]),e.find("*").each(function(){r(this).remove()}),t.removeNode(e)):(t.cleanNode(e),e.find("*").each(function(){r(this).remove()}))}}}),define("pcs/attachments/services/attachmentsDataService",["jquery","pcs/util/pcsUtil"],function(e,t){"use strict";function n(){var n=this;n.paths={taskAttachmentList:"tasks/{taskId}/attachments",ProcessesAttachmentList:"processes/{processId}/attachments",taskDcsFolderList:"tasks/{taskId}/folders",taskDcsFolderInfo:"tasks/{taskId}/folders/{folderId}"};var r=function(e,n,r){var i=new XMLHttpRequest;return i.onreadystatechange=function(){i.readyState===4&&i.status===200&&r(n,i.response)},i.open("GET",e,!0),i.withCredentials=!0,i.responseType="arraybuffer",i.setRequestHeader("Authorization",t.getAuthInfo()),t.isTestMode()&&i.setRequestHeader("pcs_mode","dev"),i.send(),i},i=function(n){return t.adfProxyCall(),e.ajax({type:"GET",cache:!1,url:n,beforeSend:function(e){e.setRequestHeader("Authorization",t.getAuthInfo()),t.isTestMode()&&e.setRequestHeader("pcs_mode","dev")},xhrFields:{withCredentials:!0},contentType:"application/json",dataType:"json"})},s=function(n,r,i){t.adfProxyCall();var s=new Uint8Array(r.length);for(var o=0;o<r.length;o++)s[o]=r.charCodeAt(o);return e.ajax({type:"POST",url:n,cache:!1,processData:!1,data:s,contentType:i,beforeSend:function(e){e.setRequestHeader("Authorization",t.getAuthInfo()),t.isTestMode()&&e.setRequestHeader("pcs_mode","dev")},xhrFields:{withCredentials:!0}})},o=function(n,r){return t.adfProxyCall(),e.ajax({type:"DELETE",url:encodeURI(n),beforeSend:function(e){e.setRequestHeader("Authorization",t.getAuthInfo()),t.isTestMode()&&e.setRequestHeader("pcs_mode","dev")},xhrFields:{withCredentials:!0},contentType:"application/json",dataType:r})};n.getAttachmentList=function(e,r){var s;return e==="task"?s=t.getRestURL()+n.paths.taskAttachmentList.replace("{taskId}",r):e==="processes"&&(s=t.getRestURL()+n.paths.ProcessesAttachmentList.replace("{processId}",r)),i(s)},n.uploadAttachment=function(e,r,i,o){var u;return e==="task"?u=t.getRestURL()+n.paths.taskAttachmentList.replace("{taskId}",r):e==="processes"&&(u=t.getRestURL()+n.paths.ProcessesAttachmentList.replace("{processesId}",r)),s(u,i,o)},n.deleteAttachment=function(e,r,i){var s;return e==="task"?s=t.getRestURL()+n.paths.taskAttachmentList.replace("{taskId}",r)+"/"+i:e==="processes"&&(s=t.getRestURL()+n.paths.ProcessesAttachmentList.replace("{processesId}",r)+"/"+i),o(s)},n.getAttachmentStream=function(e,t,n){return r(e,t,n)},n.getDcsFolders=function(e,r){var s;return e==="task"&&(s=t.getRestURL()+n.paths.taskDcsFolderList.replace("{taskId}",r)),i(s)},n.getDcsFolderInfo=function(e,r,s){var o;return e==="task"&&(o=t.getRestURL()+n.paths.taskDcsFolderInfo.replace("{taskId}",r).replace("{folderId}",s)),i(o)}}return new n}),define("text!pcs/attachments/view/attachmentsContainer.html",[],function(){return'<div class="oj-margin pcs-attachments-detailBox">\n\n	<div data-bind="if:showAttachments() && showDcsFolders()">\n		<div class="oj-flex oj-sm-flex-items-initial">\n			<div class="oj-flex-item pcs-attachments-caret-icon"  role="img" data-bind="attr:{title:bundle.pcs.attachments.foldersText}"></div>\n			<div class="oj-flex-item pcs-attachments-folders-text"><a href="#" data-bind="click : closeFolder,text:bundle.pcs.attachments.foldersText"></a></div>\n		</div>\n	</div>\n\n	<div data-bind="if:showAttachments()">\n		<div class="oj-flex oj-flex-bar">\n			<div data-bind="ifnot:showDcsFolders" class="pcs-attachments-title oj-flex-bar-start">\n				<label class="pcs-attachments-title" data-bind="text:bundle.pcs.attachments.title"></label>\n			</div>\n			<div data-bind="if:showDcsFolders" class="pcs-attachments-title oj-flex-bar-start">\n				<label class="pcs-attachments-title" data-bind="text:dscSelectedFolderName"></label>\n			</div>\n			<div class="pcs-attachments-uploadLink oj-flex-bar-end" style="padding-right:10px;" data-bind="ifnot:$data.displayDcs()">\n				<a href="#" data-bind="click : openUploadDialog, text:bundle.pcs.attachments.uploadLink"></a>\n			</div>\n		</div>\n	</div>\n	<div id="pcs-attachments-success-msg-container" style="display: none;margin-bottom:20px">\n		<span title="Success" role="img" class="oj-fwk-icon-status-confirmation oj-fwk-icon"></span>\n		<span id="pcs-attachments-success-msg" class="pcs-attachments-success-msg"></span>\n	</div>\n\n	<div id="pcs-attachments-error-msg-container" class="pcs-attachments-error-msg-container"  style="display: none">\n		<span class="oj-component-icon oj-message-status-icon oj-message-error-icon" role="img" id="pcs-attachments-error-msg-icon" style="float: left ;margin-right:10px" ></span>\n		<pre id="pcs-attachments-error-msg" class="pcs-attachments-error-msg"></pre>\n	</div>\n</div>\n\n<div class="pcs-attachments-actionBox oj-panel oj-panel-shadow-md oj-margin">\n\n\n	<div data-bind="ifnot:showAttachments()">\n		<div class="oj-flex oj-sm-flex-items-initial">\n\n			<ul class="pcs-attachments-attachmentsList" data-bind="foreach:dcsFolderList ">\n				<li>\n					<div class="oj-flex oj-flex-bar">\n						<div class="oj-flex-bar-start">\n							<!-- ko if:isFolder -->\n							<div class="oj-flex-item pcs-attachments-folder-icon"  role="img" data-bind="attr:{title:$parent.bundle.pcs.attachments.folderText}"></div>\n							<!-- /ko -->\n							<!-- ko ifnot:isFolder -->\n							<div class="oj-flex-item pcs-attachments-file-icon"  role="img" data-bind="attr:{title:$parent.bundle.pcs.attachments.fileText}"></div>\n							<!-- /ko -->\n							<div class="oj-flex-item"><a href="#" data-bind="click : $parent.openFolder,text:folderName"></a></div>\n\n						</div>\n					</div>\n				</li>\n			</ul>\n		</div>\n	</div>\n\n	<div data-bind="if:showAttachments()">\n\n		<!-- ko ifnot: $data.displayDcs() -->\n		<div data-bind="if:attachmentList().length == 0">\n			<span data-bind="text:bundle.pcs.attachments.noItemsText"></span>\n		</div>\n\n		<ul class="pcs-attachments-attachmentsList" data-bind="foreach:attachmentList ">\n			<li>\n				<div class="oj-flex oj-flex-bar">\n					<div class="oj-flex-bar-start">\n						<div data-bind="attr:{class:$parent.iconClass(filename, contentType)}">\n							<span>&nbsp;&nbsp;</span>\n						</div>\n						<div class="pcs-attachments-text">\n							<a data-bind="attr :{href:href , download : filename }, click:$parent.viewAttachment" target="_blank">\n								<p class="">\n									<span data-bind="text: filename"></span>\n								</p>\n							</a>\n							<span class="date pcs-attachments-sub-text">\n								<span data-bind="text: fileInfoText"></span>\n							</span>\n						</div>\n					</div>\n					<div class="pcs-attachments-removeFile oj-flex-bar-end">\n						<a href="#" data-bind="click:$parent.removeFileFromList">\n							<span class="oj-icon pcs-attachments-remove-icon" role="img" data-bind="attr:{title:$parent.bundle.pcs.attachments.removeFile}"></span>\n						</a>\n					</div>\n\n					<div style="display:none"  class="pcs-attachments-delete-dialog"\n						 data-bind="attr : { title : $parent.bundle.pcs.attachments.dialog_confirm}, ojComponent:{component: \'ojDialog\', initialVisibility: \'hide\'}">\n						<div class="oj-dialog-body">\n							<div data-bind="text : $parent.bundle.pcs.attachments.dialog_discard_msg"/>\n						</div>\n						<div class="oj-dialog-footer">\n							<button\n									data-bind="click : $parent.yesDeleteDialog ,\n                    ojComponent: {component: \'ojButton\', label: $parent.bundle.pcs.attachments.dialog_yes}"></button>\n							<button\n									data-bind="click : $parent.noDeleteDialog ,\n                    ojComponent: {component: \'ojButton\', label: $parent.bundle.pcs.attachments.dialog_no}"></button>\n						</div>\n					</div>\n				</div>\n				<hr/>\n			</li>\n		</ul>\n		<!-- /ko -->\n	</div>\n	<div id="pcs-attachments-overlay"/>\n\n</div>\n\n<div style="display:none" class="pcs-attachments-modalDialog"\n	 data-bind="attr: {title: bundle.pcs.attachments.uploadDialogTitle}, ojComponent:{component: \'ojDialog\', initialVisibility: \'hide\', rootAttributes: { style: \'width: 500px; min-width: 200px; max-width 500px;\'}}">\n	<div class="oj-dialog-body oj-form">\n		<div class="oj-flex">\n			<div class="oj-flex-item">\n				<div data-bind="ifnot:showDcsFolders">\n			<h6 data-bind="text:bundle.pcs.attachments.uploadSizeLimitText"></h6>\n		</div>\n			<div data-bind="if:showDcsFolders">\n				<h6 data-bind="text:bundle.pcs.attachments.docsUploadSizeLimitText"></h6>\n			</div>\n		</div>\n		</div>\n		<div class="oj-flex pcs-attachments-dialog-error-msg">\n			<span class="oj-fwk-icon-status-error"></span>&nbsp;&nbsp;<span class="oj-flex-item" data-bind="text: bundle.pcs.attachments.fileExists"></span>\n		</div>\n		<div class="oj-flex oj-sm-odd-cols-12 oj-md-odd-cols-4 oj-md-labels-inline\n			 oj-form-cols-labels-inline oj-form-cols-max2">\n			<div class="oj-flex-item">\n				<label for="pcs-attachments-fileControl" data-bind="text:bundle.pcs.attachments.browseToUploadLabel"></label>\n			</div>\n			<div class="oj-flex-item">\n				<input id="pcs-attachments-fileControl" type="file" class="pcs-attach-file-name"  title="Upload file" style="float:left; margin-left: 20px" />\n				<div class="pcs-empty-file-name-text" style="display: none;color:red;clear: both;" class="text-error" data-bind="text:bundle.pcs.attachments.emptyAddFileText"></div>\n			</div>\n		</div>\n	</div>\n	<div class="oj-dialog-footer">\n		<button class="pcs-attachments-upload-btn" data-bind="click: uploadAttachment, ojComponent: {component: \'ojButton\', label: \'Upload\', disabled : \'true\'}"> </button>\n	</div>\n</div>\n\n<div style="display:none" class="pcs-attachments-dcsModalDialog"\n	   data-bind="attr: {title: bundle.pcs.attachments.documents_dialog_title}, ojComponent:{component: \'ojDialog\', initialVisibility: \'hide\', close :dcsDialogClose, rootAttributes: { style: \'width: 800px; min-width: 300px; max-width 800px;\'}}">\n	<div class="oj-dialog-body" style="height:600px">\n		<iframe id="pcs-attachment-iframe" target="_top" data-bind="attr: {src: $data.dscSelectedAppLink}" frameborder="0" seamless="seamless" scrolling="auto"\n				style="overflow-x:hidden; width:100%;" height=550px" >\n			<p>Your browser does not support iframes.</p>\n		</iframe>\n\n	</div>\n\n</div>'}),define("pcs/attachments/viewModel/attachmentsContainer",["ojs/ojcore","knockout","pcs/util/pcsUtil","pcs/attachments/services/attachmentsDataService","ojs/ojknockout","ojs/ojdialog","ojs/ojbutton","text!pcs/attachments/view/attachmentsContainer.html","ojL10n!pcsMsg/nls/pcsSnippetsResource"],function(e,t,n,r){"use strict";function i(i){function o(e){if(e){s.displayDcs(!0);for(var t=0;t<e.length;t++){var n={folderId:e[t].folderId,folderName:e[t].folderName};e[t].type&&e[t].type==="d"?n.isFolder=!1:n.isFolder=!0,s.dcsFolderList.unshift(n)}}$("#pcs-attachments-overlay").removeClass("pcs-common-load-overlay"),s.rootElement.trigger("attachments:loaded")}function u(e,t){var n=t;e&&e.status===0&&(n=s.bundle.pcs.common.server_not_reachable),e&&e.status===500?n=e.responseText:e&&e.status===401&&(n=s.bundle.pcs.common.access_error_msg),$("#pcs-attachments-error-msg",s.rootElement).text(n),$("#pcs-attachments-error-msg-container",s.rootElement).show().delay(5e3),$("#pcs-attachments-overlay").removeClass("pcs-common-load-overlay")}function a(n){if(n)for(var r=0;r<n.length;r++){var i="";n[r].updatedDate&&n[r].updatedBy&&(i=s.bundle.pcs.attachments.dateByUserText,i=e.Translations.applyParameters(i,{0:n[r].updatedDate,1:n[r].updatedBy}));var o={filename:n[r].title,fileInfoText:i,serverUri:n[r].uri.href,href:t.observable("#"),contentType:n[r].mimeType};s.attachmentList.unshift(o)}$("#pcs-attachments-overlay").removeClass("pcs-common-load-overlay"),s.rootElement.trigger("attachments:loaded")}function f(e,t){e==="task"?($("#pcs-attachments-overlay").addClass("pcs-common-load-overlay"),s.data.isDocsEnabled?r.getDcsFolders(e,t).done(function(e){o(e.dcsfolder)}).fail(function(e,t,n){var r=s.bundle.pcs.attachments.fetch_attachments_error;u(e,r),s.rootElement.trigger("attachments:loaded")}):(s.displayDcs(!1),r.getAttachmentList(e,t).done(function(e){a(e.attachment)}).fail(function(e,t,n){var r=s.bundle.pcs.attachments.fetch_attachments_error;u(e,r),s.rootElement.trigger("attachments:loaded")}))):e==="processes"&&($("#pcs-attachments-overlay").addClass("pcs-common-load-overlay"),r.getAttachmentList(e,t).done(function(e){a(e.attachment)}).fail(function(e,t,n){var r=s.bundle.pcs.attachments.fetch_attachments_error;u(e,r),s.rootElement.trigger("attachments:loaded")}))}function c(e){$("#pcs-attachments-overlay").removeClass("pcs-common-load-overlay"),$(".pcs-attachments-dcsModalDialog").ojDialog("open"),s.msg={message:"setAppLinkTokens",appLinkRefreshToken:JSON.parse(e).refreshToken,appLinkAccessToken:JSON.parse(e).accessToken,appLinkRoleName:JSON.parse(e).role,embedPreview:!0},s.addDCSEventListener();var t=JSON.parse(e).appLinkUrl+"/cfg=hbr,evw,hdc,ndw";s.dscSelectedAppLink(t)}function g(e){var t=new Uint8Array(e),n=32768,r=[];for(var i=0;i<t.length;i+=n)r.push(String.fromCharCode.apply(null,t.subarray(i,i+n)));return r.join("")}var s=this;this.data=i.data,s.bundle=require("ojL10n!pcsMsg/nls/pcsSnippetsResource"),s.attachmentList=t.observableArray([]),s.dcsFolderList=t.observableArray([]),s.showDcsFolders=t.observable(!1),s.showAttachments=t.observable(!0),s.dscSelectedFolderName=t.observable(""),s.dscSelectedAppLink=t.observable(""),s.displayDcs=t.observable(!1),this.data.isDocsEnabled?(s.showDcsFolders(!0),s.showAttachments(!1)):(s.showDcsFolders(!1),s.showAttachments(!0));if(this.data.startFolderName!==""&&this.data.mode!=="task"&&this.data.mode!=="processes"){s.displayDcs(!1);var l={folderId:"",folderName:this.data.startFolderName,isFolder:!0};s.dcsFolderList.unshift(l)}this.data.container=s,this.rootElement=s.data.rootElement,s.data.hideDelete&&$(".pcs-attachments-removeFile",s.rootElement).hide(),s.data.hideUploadLink&&$(".pcs-attachments-uploadLink",s.rootElement).hide(),s.data.hideTitle&&$(".pcs-attachments-title",s.rootElement).hide(),s.data.mode==="task"||s.data.mode==="processes"?f(s.data.mode,s.data.id):s.rootElement.trigger("attachments:loaded"),s.openUploadDialog=function(){$(".pcs-attachments-dialog-error-msg").css("display","none"),$("#pcs-attachments-fileControl",this.element).val(""),$(".pcs-attachments-modalDialog").ojDialog("open"),$(".pcs-attachments-upload-btn").ojButton("option","disabled",!0)},s.openFolder=function(e){s.dscSelectedFolderName(e.folderName),s.data.mode==="task"&&e.folderId!==""?($("#pcs-attachments-overlay").addClass("pcs-common-load-overlay"),r.getDcsFolderInfo(s.data.mode,s.data.id,e.folderId).done(function(e){c(e.mafLink)}).fail(function(e,t,n){var r=s.bundle.pcs.attachments.fetch_attachments_error;u(e,r)})):s.showAttachments(!0)},s.dcsDialogClose=function(){console.log("closing"),s.cleanDCSEventListener()},s.OnDCSMessageEvent=function(e){if(e.data.message==="appLinkReady"){console.log("recieved");var t=$("#pcs-attachment-iframe")[0],n=t.contentWindow?t.contentWindow:t.contentDocument.defaultView;n.postMessage(s.msg,"*")}},s.cleanDCSEventListener=function(){console.log("removing"),n.eventHandler.removeHandler(window,"message",s.OnDCSMessageEvent)},s.addDCSEventListener=function(){console.log("adding"),n.eventHandler.addHandler(window,"message",s.OnDCSMessageEvent)},s.closeFolder=function(){s.showAttachments(!1)},s.iconClass=function(e,t){if(e)return t==="application/pdf"?"pcs-attachments-filepdf-icon":t==="application/zip"?"pcs-attachments-filezip-icon":t&&t.startsWith("image")?"pcs-attachments-fileimage-icon":t==="text/plain"?"pcs-attachments-filetxt-icon":e.endsWith("xls")||e.endsWith("xlsx")?"pcs-attachments-filexls-icon":e.endsWith("doc")||e.endsWith("docx")?"pcs-attachments-filedoc-icon":e.endsWith("ppt")||e.endsWith("pptx")?"pcs-attachments-fileppt-icon":"pcs-attachments-fileother-icon"},s.removeFileFromList=function(e,t){var n=$(t.currentTarget).parent();n.siblings().find(".pcs-attachments-delete-dialog").ojDialog("open")},s.yesDeleteDialog=function(t){if(s.data.mode==="task"||s.data.mode==="processes"){var n=t.filename,i=t;$("#pcs-attachments-overlay").addClass("pcs-common-load-overlay"),r.deleteAttachment(s.data.mode,s.data.id,n).done(function(t){s.attachmentList.remove(i),s.rootElement.trigger("attachments:attachmentRemoved",[i]),$(".pcs-attachments-delete-dialog").ojDialog("close");var r=s.bundle.pcs.attachments.upload_attachment_delete;r=e.Translations.applyParameters(r,{0:n}),$("#pcs-attachments-success-msg",s.rootElement).text(r),$("#pcs-attachments-success-msg-container",s.rootElement).show().delay(5e3).fadeOut(2e3),$("#pcs-attachments-overlay").removeClass("pcs-common-load-overlay")}).fail(function(e,t,n){var r=s.bundle.pcs.attachments.delete_attachment_error;u(e,r)})}else s.attachmentList.remove(t),s.rootElement.trigger("attachments:attachmentRemoved",[t]),$(".pcs-attachments-delete-dialog").ojDialog("close")},s.noDeleteDialog=function(){$(".pcs-attachments-delete-dialog").ojDialog("close")};var h={};s.uploadAttachment=function(){if(h.name!==""){for(var t=0;t<s.attachmentList().length;t++)if(s.attachmentList()[t].filename===h.name){$(".pcs-attachments-dialog-error-msg").css("display","block");return}var n=s.bundle.pcs.attachments.dateByUserTextTmp,i={filename:h.name,fileInfoText:n,href:h.src,contentType:h.contentType,content:h.content};if(s.data.mode==="task"||s.data.mode==="processes"){$("#pcs-attachments-overlay").addClass("pcs-common-load-overlay");var o="Boundary_123456789_123456789",a="--"+o+"\r\n",f="\r\n--"+o+"--\r\n",l=a;l+="Content-Disposition: inline\r\n",l+="Content-Type: application/json\r\n\r\n";var c={attachmentName:i.filename,mimeType:i.contentType,attachmentSize:h.size,attachmentScope:"BPM"};l+=JSON.stringify(c)+"\r\n",l+=a,l+="Content-Transfer-Encoding: binary\r\n\r\n",l+=i.content,l+=f;var p="multipart/mixed; boundary="+o;r.uploadAttachment(s.data.mode,s.data.id,l,p).done(function(t){s.attachmentList.unshift(i),s.rootElement.trigger("attachments:attachmentUploaded",[i]);var n=s.bundle.pcs.attachments.upload_attachment_success;n=e.Translations.applyParameters(n,{0:i.filename}),$("#pcs-attachments-success-msg",s.rootElement).text(n),$("#pcs-attachments-success-msg-container",s.rootElement).show().delay(5e3).fadeOut(2e3),$("#pcs-attachments-overlay").removeClass("pcs-common-load-overlay")}).fail(function(e,t,n){var r=s.bundle.pcs.attachments.upload_attachment_error;u(e,r)})}else s.attachmentList.unshift(i),s.rootElement.trigger("attachments:attachmentUploaded",[i])}$(".pcs-attachments-modalDialog").ojDialog("close")};if(s.data.attachments)for(var p=0;p<s.data.attachments.length;p++){var d=null,v=function(e,t){var n=new Uint8Array(e.length);for(var r=0;r<e.length;r++)n[r]=e.charCodeAt(r);var i=new Blob([n],{type:t});return d!==null&&window.URL.revokeObjectURL(d),d=window.URL.createObjectURL(i),d},m=s.data.attachments[p];m.href===""&&(m.href=v(m.content,m.contentType)),s.attachmentList.unshift(m)}$("#pcs-attachments-fileControl").change(function(e){var t=e.target.files[0];if(t){var n=new FileReader;n.onload=function(e){h.name=t.name,h.content=g(e.target.result),t.type===""?h.contentType="application/octet-stream":h.contentType=t.type,h.size=t.size,h.src=window.URL.createObjectURL(t)},n.readAsArrayBuffer(t)}else console.log("Failed to load file");$(".pcs-attachments-upload-btn").ojButton("option","disabled",!1)}),s.dispose=function(){console.log("dispose in attachment Containor")},s.viewAttachment=function(e,n){var i,s,o;if(t.isObservable(e.href)){var u=$(n.currentTarget),a=function(e,t){var n=new Blob([t],{type:e.contentType}),r=window.URL.createObjectURL(n);e.href(r),e.content=g(t),$("#pcs-attachments-overlay").removeClass("pcs-common-load-overlay"),window.navigator.msSaveOrOpenBlob?window.navigator.msSaveOrOpenBlob(n,e.filename):u[0].click()};if(e.href()==="#")return $("#pcs-attachments-overlay").addClass("pcs-common-load-overlay"),r.getAttachmentStream(e.serverUri,e,a,u),!1;if(window.navigator.msSaveOrOpenBlob){i=new Uint8Array(e.content.length);for(o=0;o<e.content.length;o++)i[o]=e.content.charCodeAt(o);return s=new Blob([i],{type:e.contentType}),window.navigator.msSaveOrOpenBlob(s,e.filename),!1}return!0}if(window.navigator.msSaveOrOpenBlob){i=new Uint8Array(e.content.length);for(o=0;o<e.content.length;o++)i[o]=e.content.charCodeAt(o);return s=new Blob([i],{type:e.contentType}),window.navigator.msSaveOrOpenBlob(s,e.filename),!1}return!0}}return i}),define("pcs/pcs.attachments",["ojs/ojcore","knockout","jquery","text!pcs/attachments/templates/pcs-attachments.html","ojL10n!pcsMsg/nls/pcsSnippetsResource","jqueryui-amd/widget","pcs/attachments/viewModel/attachmentsContainer","text!pcs/attachments/view/attachmentsContainer.html"],function(e,t,n,r,i){"use strict";n.widget("pcs.attachments",{options:{hideDelete:!1,hideUploadLink:!1,hideTitle:!1,attachments:[],startFolderName:"",mode:"start",id:-1,readOnly:!1,isDocsEnabled:!1},_create:function(){function o(){var n=this;t.components.isRegistered("attachmentComponent")||t.components.register("attachmentComponent",{template:{require:"text!pcs/attachments/view/attachmentsContainer.html"},viewModel:{require:"pcs/attachments/viewModel/attachmentsContainer"}}),n.data=s,e.options.readOnly&&(n.data.hideUploadLink=!0,n.data.hideDelete=!0)}var e=this;if(n.pcsConnection===undefined){this.element.html("<div style='color:red'>"+i.pcs.common.pcs_connection+" </div>");return}var s={rootElement:e.element,hideDelete:e.options.hideDelete,hideUploadLink:e.options.hideUploadLink,hideTitle:e.options.hideTitle,attachments:e.options.attachments,startFolderName:e.options.startFolderName,mode:e.options.mode,id:e.options.id,isDocsEnabled:e.options.isDocsEnabled},u=new o;e.model=u,this.element.html(r),t.applyBindings(u,this.element[0])},destroy:function(){n.Widget.prototype.destroy.call(this)},_destroy:function(){console.log("Destroying attachments"),this.model&&this.model.data&&this.model.data.container&&this.model.data.container.dispose()},_setOption:function(e,t){this.options[e]=t,n.Widget.prototype._setOption.apply(this,arguments)},getAttachments:function(){var e=this.model.data.container.attachmentList();return e}})});