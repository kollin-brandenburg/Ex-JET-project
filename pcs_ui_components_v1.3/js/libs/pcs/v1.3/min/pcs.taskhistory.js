/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*
 RequireJS i18n 2.0.2 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/requirejs/i18n for details
*/

define("text",["module"],function(e){"use strict";var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.12",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}d.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("ï»¿")===0&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!pcs/taskhistory/templates/pcs-task-history-container.html",[],function(){return'<div id="pcs-th-panelPage">\n	<div class="oj-flex">\n		<div class="oj-panel oj-panel-alt2 oj-margin demo-mypanel"  style="background-color: #e9ebee;">\n			<div >\n				<h3 style="background-color: #c9d3dd; padding: 10px; margin: -14px;" data-bind="text:bundle.pcs.taskHistory.history"></h3>\n				<div>\n					<div style="padding-left: 30px; padding-top: 30px; margin-right: 100px;">\n						<ul style="border-left: 3px solid #6ae25d; list-style: none outside;">\n							<div id="pcs-th-taskHistoryDiv-new">\n\n								<!-- ko foreach: procHistData -->\n\n								<li data-bind="visible: $data.activityType === \'START_EVENT\'" class=\'pcs-th-green-dot-image\'>\n\n									<span data-bind="html: $data.displayMessage"/>\n									<br>\n									<span class=\'pcs-th-history-date\' data-bind="text: $data.creationDate"/>\n									<br><br><br>\n\n								</li>\n\n								<li data-bind="visible: $data.activityType === \'END_EVENT\'" class=\'pcs-th-green-dot-image\'>\n\n									<span data-bind="text: $data.displayMessage"/>\n									<br>\n									<span class=\'pcs-th-history-date\' data-bind="text: $data.creationDate"/>\n									<br><br><br>\n\n								</li>\n\n								<li data-bind="visible: $data.activityType === \'FUTURE_TASK\'" class=\'pcs-th-grey-dot-image\'>\n\n									<span data-bind="html: $data.displayMessage"/>\n									<br><br><br>\n\n								</li>\n\n								<li data-bind="visible: ($data.activityType === \'USER_TASK\' && $data.showExpanded === \'false\')" class=\'pcs-th-green-dot-image\'>\n\n									<span class=\'pcs-th-history-task-title\' data-bind="text: $data.displayMessage"/>\n									<br>\n									<span class=\'pcs-th-history-date\' data-bind="text: $data.creationDate"/>\n									<br><br><br>\n\n								</li>\n\n\n								<div data-bind="visible: ($data.activityType === \'USER_TASK\' && $data.showExpanded === \'true\')">\n\n									<li  class=\'pcs-th-blue-dot-image pcs-th-history-user-task-top\'>\n\n										<span class=\'pcs-th-history-task-title\' data-bind="text: $data.displayMessage"/>\n										<br>\n										<span class=\'pcs-th-history-date\' data-bind="text: $data.creationDate"/>\n										<br><br>\n\n										<!--assigneesHTMLTable starts -->\n\n\n										<!--<table>\n                                            <tr>\n                                                <td rowspan=\'2\' style=\'padding-left: 0px\'>\n                                                    <table>\n                                                        <tr>\n                                                            <td class=\'pcs-th-assignee-table\'>\n                                                                <div data-bind="attr: { class: $data.routingTypeImageClass, title: $data.routingTypeImageTitle }"/>\n                                                                &lt;!&ndash;<img data-bind="attr: { class: $data.routingTypeImageClass, title: $data.routingTypeImageTitle }">&ndash;&gt;\n                                                            </td>\n                                                        </tr>\n                                                        <tr>\n                                                            <td class=\'pcs-th-assignee-table\'>\n                                                                <span data-bind="text: $data.routingTypeMoreInfo"/>\n                                                            </td>\n                                                        </tr>\n                                                    </table>\n                                                </td>\n                                                &lt;!&ndash; ko foreach: $data.originalAssignees &ndash;&gt;\n\n                                                    <td class=\'pcs-th-assignee-table\'>\n                                                        <div data-bind="css: $data.assigneeTypeImageClass"/>\n                                                        &lt;!&ndash;<img data-bind="css: $data.assigneeTypeImageClass">&ndash;&gt;\n                                                    </td>\n\n                                                &lt;!&ndash; /ko&ndash;&gt;\n                                            </tr>\n                                            <tr>\n                                                &lt;!&ndash; ko foreach: $data.originalAssignees &ndash;&gt;\n                                                    <td class=\'pcs-th-assignee-table\'>\n                                                        <span class=\'pcs-th-history-assignee-text\' data-bind="text: $data.id">\n                                                        </span>\n                                                    </td>\n                                                &lt;!&ndash; /ko&ndash;&gt;\n                                            </tr>\n                                        </table>-->\n\n										<!--assigneesHTMLTable ends -->\n\n									</li>\n\n									<!-- ko foreach: $data.detailedHistory -->\n\n									<li data-bind="visible: $data.actionType === \'REGULAR\'" class=\'pcs-th-history-user-task-other-rows\' style=\'padding-bottom: 26px;\'>\n\n										<div style=\'float:left; padding-right: 34px; margin-left: -10px\' data-bind="css: $data.imageClass">\n											<!--<img data-bind="css: $data.imageClass">-->\n										</div>\n\n										<span style=\'padding-top: 11px; float: left;\' data-bind="html: $data.displayMessage"/> &nbsp &nbsp\n										<span class=\'pcs-th-history-date pcs-th-history-date-float-right\' style=\'padding-top: 11px;\' data-bind="text: $data.creationDate"/>\n\n									</li>\n\n									<li data-bind="visible: $data.actionType === \'COMMENT_ADDED\'" class=\'pcs-th-history-user-task-other-rows\'>\n										<div style=\'float:left; padding-right: 34px; margin-left: -10px\' data-bind="css: $data.imageClass">\n											<!--<img data-bind="css: $data.imageClass">-->\n										</div>\n										<span data-bind="html: $data.displayMessage"></span> &nbsp &nbsp\n										<span class=\'pcs-th-history-date pcs-th-history-date-float-right\' data-bind="text: $data.creationDate"></span>\n										<br>\n										<span class=\'pcs-th-history-comment\' data-bind="text: $data.comments"></span>\n									</li>\n\n									<li data-bind="visible: $data.actionType === \'ATTACHMENT_ADDED\'" class=\'pcs-th-history-user-task-other-rows\'>\n\n										<div style=\'float:left; padding-right: 34px; margin-left: -10px\' data-bind="css: $data.imageClass">\n											<!--<img data-bind="css: $data.imageClass">-->\n										</div>\n										<span data-bind="html: $data.displayMessage"></span> &nbsp &nbsp\n										<span class=\'pcs-th-history-date pcs-th-history-date-float-right\' data-bind="text: $data.creationDate"></span>\n										<br>\n\n										<!--<span class=\'pcs-th-history-comment\' data-bind="text: $data.attachmentName"></span>-->\n\n										<a href="#"  data-bind="text: $data.attachmentName, value : $data.attachmentURL, click:$root.onAttachmentClick"/>\n\n\n\n									</li>\n\n									<!-- /ko-->\n\n									<br><br>\n\n\n								</div>\n\n\n\n								<!-- /ko-->\n\n\n\n							</div>\n						</ul>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n\n\n<!--<div id="pcs-th-panelPage-temp">\n	<div class="oj-flex">\n		<div class="oj-panel oj-panel-alt2 oj-margin demo-mypanel"  style="background-color: #e9ebee;">\n			<div >\n				<h3 style="background-color: #c9d3dd; padding: 10px; margin: -14px;" data-bind="text:bundle.pcs.taskHistory.history"></h3>\n				<div>\n					<div style="padding-left: 30px; padding-top: 30px; margin-right: 100px;">\n						<ul style="border-left: 3px solid #6ae25d; list-style: none outside;">\n							<div id="pcs-th-taskHistoryDiv">\n\n\n\n\n\n							</div>\n						</ul>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>-->\n'}),define("pcs/util/pcsUtil",["module","knockout","ojs/ojcore","jquery"],function(e,t,n,r){"use strict";function a(){var e={},t;if(window.location.href.indexOf("?")===-1)return e;var n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&");for(var r=0;r<n.length;r++){t=n[r].split("=");var i=decodeURIComponent(t[0]),s=decodeURIComponent(t[1]),o=JSON.parse(s);e[i]=o}return e}var i={};r.CustomEvent=function(e){var t,n=e&&i[e];return n||(t=r.Callbacks(),n={publish:t.fire,subscribe:t.add,unsubscribe:t.remove},e&&(i[e]=n)),n};var s={addHandler:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},removeHandler:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null}};String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,value:function(e,t){return t=t||0,this.substr(t,e.length)===e}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{enumerable:!1,value:function(e,t){var n=this.toString();if(typeof t!="number"||!isFinite(t)||Math.floor(t)!==t||t>n.length)t=n.length;t-=e.length;var r=n.indexOf(e,t);return r!==-1&&r===t}});var o=function(e){typeof window.doADFProxyCall=="function"?window.doADFProxyCall(e):e&&window.location.assign(e)},u=function(e){function a(e){var t=e.split("\r\n"),n="text/plain",r="pcsFormUrl",i={contentType:n,fieldName:r};for(var s=1;s<t.length;s++){var o=t[s],u=o.match(/^.*filename="([^"]*)"/);if(u)i.fieldName=u[1];else{var a="Content-Type:";o.indexOf(a)>-1&&(u=o.substring(o.indexOf(a)+a.length)),u&&(i.contentType=u.trim())}}return i}var t=e.getResponseHeader("Content-Type"),n=e.response,r=t.match(/boundary=(?:'([^']+)'|([^;]+))/i);if(!r)throw new Error("Bad content-type header, no multipart boundary");var i=r[1]||r[2],s=typeof n!="string",o,u;i="\r\n--"+i;if(s){var f=new Uint8Array(n),l=32768,c=[];for(u=0;u<f.length;u+=l)c.push(String.fromCharCode.apply(null,f.subarray(u,u+l)));o=c.join("")}else o=n;o="\r\n"+o;var h=o.split(new RegExp(i)),p={};for(u=1;u<h.length-1;u++){var d="\r\n\r\n",v=h[u].substring(h[u].indexOf(d)+d.length),m=h[u].substring(0,h[u].indexOf(d)),g=a(m),y=!1;s&&!g.contentType.startsWith("text")&&(y=!0),p[g.fieldName]={data:v,contentType:g.contentType,fileName:g.fieldName}}return p},f=function(e){return r.ajax({type:"GET",url:e,dataType:"text",xhrFields:{withCredentials:!0}})};return t.bindingHandlers.formatDateInMillis={update:function(e,r,i){var s=t.unwrap(r());if(!s)return;var o={formatType:"date",pattern:i().datePattern},u=n.Validation.converterFactory("datetime").createConverter(o),a=u.format(n.IntlConverterUtils.dateToLocalIso(new Date(s)));t.bindingHandlers.text.update(e,function(){return a})}},{adfProxyCall:o,getAuthToken:f,multipartParse:u,getUrlParametersObject:a,eventHandler:s,initComponentForIFrame:function(e,t,n){if(!r.isEmptyObject(r.pcsConnection))t();else{r.pcsConnection={};if(!r.isEmptyObject(e)){e.testMode&&(r.pcsConnection.testMode=e.testMode),e.serverURL&&(r.pcsConnection.serverURL=e.serverURL);if(e.authInfo){r.pcsConnection.authInfo=e.authInfo,t();return}}var i=this,s=function(){var e=i.getServerURL();console.log("Script loaded and ready, getting token"),i.getAuthToken(e+"/bpm/workspace/auth/token").done(function(e){e&&e.startsWith("<html")?n.text("User cannot be authorized").show():(r.pcsConnection.authInfo="Bearer "+e,t())}).fail(function(e){n.text("User cannot be authorized").show()})},o=document.createElement("script");o.onload=s,o.onreadystatechange=function(){this.readyState==="complete"&&s()};var u=this.getServerURL();o.src=u+"/bpm/workspace/faces/js/homePage.js",document.getElementsByTagName("head")[0].appendChild(o)}},getCookie:function(e){var t;return(t=(new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)")).exec(document.cookie))?t[1]:null},getServerURL:function(){if(r.pcsConnection&&r.pcsConnection.serverURL)return r.pcsConnection.serverURL.endsWith("/")?r.pcsConnection.serverURL.substring(0,r.pcsConnection.serverURL.length-1):r.pcsConnection.serverURL;if(e.uri.indexOf(".")===0||e.uri.indexOf("/")===0)return window.location.origin;try{return(new URL(e.uri)).origin}catch(t){return window.location.origin}},getRestUri:function(){return"/bpm/api/3.0/"},getAuthInfo:function(){if(r.pcsConnection&&r.pcsConnection.authInfo){var e=r.pcsConnection.authInfo;return!e.startsWith("Bearer ")&&!e.startsWith("Basic ")&&(e="Bearer "+e),e}return""},getRestURL:function(){if(r.pcsConnection&&r.pcsConnection.restURL)return r.pcsConnection.restURL;var e=this.getServerURL()+this.getRestUri();return r.pcsConnection&&(r.pcsConnection.restURL=e),e},isTestMode:function(){return r.pcsConnection&&r.pcsConnection.testMode?!0:!1},taskIconColor:function(e){if(!e)return"grey";var t=0,n,r,i;for(n=0,i=e.length;n<i;n++)r=e.charCodeAt(n),t=(t<<5)-t+r,t|=0;var s=t,o=s&255;s>>=8;var u=s&255;s>>=8;var a=s&255;return"rgb("+a+","+u+","+o+")"},taskInitials:function(e){if(!e)return"NA";e=e.replace(" ","");var t=e.charAt(0).toUpperCase(),n="";for(var r=1;r<e.length;r++)if(e.charAt(r)===e.charAt(r).toUpperCase()){n=e.charAt(r);break}return t+n},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},unApplyBindings:function(e,n){e.find("*").each(function(){r(this).off(),r(this).unbind()}),e.off(),n?(t.cleanNode(e[0]),e.find("*").each(function(){r(this).remove()}),t.removeNode(e)):(t.cleanNode(e),e.find("*").each(function(){r(this).remove()}))}}}),define("pcs/data-services/DataServices",["require","jquery","pcs/util/pcsUtil"],function(e){"use strict";var t=e("jquery"),n=e("pcs/util/pcsUtil");return function(){function f(){return{get:function(e,n,r){return e.indexOf(i(r))===-1&&(e=i(r)+e),n&&n.queryParams&&(e+="?"+u(n.queryParams)),t.ajax({type:"GET",url:e,beforeSend:o,xhrFields:{withCredentials:!0},contentType:n&&n.contentType?n.contentType:"application/json",dataType:n&&n.dataType?n.dataType:"json"})},post:function(e,n,r){e.indexOf(i(r))===-1&&(e=i(r)+e),n.contentType==null&&(n.contentType="application/json");var s=a(n.contentType,n.payload);return t.ajax({type:"POST",url:e,cache:!1,processData:!1,data:s,beforeSend:o,xhrFields:{withCredentials:!0},contentType:n.contentType,dataType:n&&n.dataType?n.dataType:"json"})},put:function(e,n,r){e.indexOf(i(r))===-1&&(e=i(r)+e),n.contentType==null&&(n.contentType="application/json");var s=a(n.contentType,n.payload);return t.ajax({type:"PUT",url:e,cache:!1,processData:!1,data:s,beforeSend:o,xhrFields:{withCredentials:!0},contentType:n.contentType,dataType:n&&n.dataType?n.dataType:"json"})},"delete":function(e,t){}}}var e,r={credentials:n.getAuthInfo(),baseUrl:n.getServerURL()+"/bpm/api/3.0"},i=function(e){return e?n.getServerURL()+"/bpm/api/"+e:n.getServerURL()+"/bpm/api/3.0"},s=function(){return n.getAuthInfo()},o=function(e){e.setRequestHeader("Authorization",s()),n.isTestMode()&&e.setRequestHeader("pcs_mode","dev")},u=function(e){var t=[];if(e instanceof Array)e.forEach(function(e){for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]))});else for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},a=function(e,t){var n=JSON.stringify(t);if(!e&&e.startsWith("multipart")){n=new Uint8Array(t.length);for(var r=0;r<t.length;r++)n[r]=t.charCodeAt(r)}return n};return{getInstance:function(t){return e||(e=f()),t?e.connection=t:r&&(e.connection=r),e},setConnection:function(t){e||(e=f()),e.connection=t},serializeUrlParams:function(e){return u(e)}}}()}),define("pcs/tasklist/viewModel/Task",[],function(){"use strict";return function(e,t){if(t&&t.hasOwnProperty("update"))for(var n in e){if(!e.hasOwnProperty(n))continue;t.update.hasOwnProperty(n)&&(e[n]=typeof t.update[n]=="function"?t.update[n](e[n]):e[n])}return{getTitle:function(){return e.title},getNumber:function(){return e.number},getFromUser:function(){return e.fromUserDisplayName},getState:function(){return e.state},getAssignees:function(){return e.assignees.items},getCreator:function(){return e.creatorName},getAssignedDate:function(){return e.assignedDate},getCreatedDate:function(){return e.createdDate},getPriority:function(){return e.priority},getFromUserName:function(){return e.fromUserName},getFromUserDisplayName:function(){return e.fromUserDisplayName},getShortSummary:function(){return e.shortSummary},getDueDate:function(){return e.dueDate},getProcessName:function(){return e.processName},getUpdatedDate:function(){return e.updatedDate},getActionList:function(){return e.actionList}}}}),define("pcs/taskhistory/viewModel/TaskHistory",["jquery","pcs/data-services/DataServices","pcs/tasklist/viewModel/Task"],function(e,t,n){"use strict";var r={tasks:"/tasks",processAudit:"/processes"},i=t.getInstance();return function(t){var n={};return n.options=t,{fetchTask:function(t){var n=r.tasks,s=e.Deferred();return n+="/"+t,i.get(n,null,"4.0").done(function(e){s.resolve(e)}).fail(function(e){s.reject(e)}),s},fetchProcessAuditInfo:function(t,n){var s=r.processAudit,o=e.Deferred();return s+="/"+t,s+="/audit?graphicFlag=false&filterActivitiesBy=USER_TASK&filterActivitiesBy=START_EVENT&filterActivitiesBy=END_EVENT&includeFutureTasksFlag=true",s+="&currentTaskNumber="+n,i.get(s,null,"4.0").done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}),o}}}}),function(){function e(e,t,n,r,i,s){return t[e]||(e=e.replace(/^zh-(Hans|Hant)-([^-]+)$/,"zh-$2")),t[e]?(n.push(e),!0!==t[e]&&1!==t[e]||r.push(i+e+"/"+s),!0):!1}function t(e){var t=e.toLowerCase().split(/-|_/);e=[t[0]];var n=1,r;for(r=1;r<t.length;r++){var i=t[r],s=i.length;if(1==s)break;switch(n){case 1:if(n=2,4==s){e.push(i.charAt(0).toUpperCase()+i.slice(1));break};case 2:n=3,e.push(i.toUpperCase());break;default:e.push(i)}}if(!("zh"!=e[0]||1<e.length&&4==e[1].length)){t="Hans",n=1<e.length?e[1]:null;if("TW"===n||"MO"===n||"HK"===n)t="Hant";e.splice(1,0,t)}return e}function n(e,t){for(var r in t)t.hasOwnProperty(r)&&(null==e[r]?e[r]=t[r]:"object"==typeof t[r]&&"object"==typeof e[r]&&n(e[r],t[r]))}var r=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define("ojL10n",["module"],function(i){var s=i.config?i.config():{};return{version:"2.0.1+",load:function(i,o,u,a){a=a||{},a.locale&&(s.locale=a.locale);var f=r.exec(i),l=f[1],c,h=f[5],p,d=[],v={},m,g="",w,E,S,T,N,C;f[5]?(l=f[1],i=l+h,c=f[4]):(h=f[4],c=s.locale,"undefined"!=typeof document?(c||(c=a.isBuild?"root":document.documentElement.lang)||(c=void 0===navigator?"root":navigator.language||navigator.userLanguage||"root"),s.locale=c):c="root"),p=t(c),w=s.noOverlay,E=s.defaultNoOverlayLocale;if(f=s.merge)if(S=f[l+h])f=r.exec(S),T=f[1],N=f[4];C=[];for(m=0;m<p.length;m++)f=p[m],g+=(g?"-":"")+f,C.push(g);a.isBuild?(d.push(i),S&&d.push(S),o(d,function(){u()})):("query"==s.includeLocale&&(i=o.toUrl(i+".js"),i+=(-1===i.indexOf("?")?"?":"&")+"loc="+c),a=[i],S&&a.push(S),o(a,function(t,r){var i=[],s,a=!1,f=w||!0===t.__noOverlay,c=E||t.__defaultNoOverlayLocale;for(m=C.length-1;0<=m&&(!a||!f);m--)a=e(C[m],t,i,d,l,h);f&&!a&&c&&e(c,t,i,d,l,h),e("root",t,i,d,l,h),s=i.length;if(r){a=!1,f=!0===r.__noOverlay,c=r.__defaultNoOverlayLocale;for(m=C.length-1;0<=m&&(!a||!f);m--)a=e(C[m],r,i,d,T,N);f&&!a&&c&&e(c,r,i,d,T,N),e("root",r,i,d,T,N)}o(d,function(){var e,a,f;for(e=s;e<i.length&&i[e];e++){f=i[e],a=r[f];if(!0===a||1===a)a=o(T+f+"/"+N);n(v,a)}for(e=0;e<s&&i[e];e++){f=i[e],a=t[f];if(!0===a||1===a)a=o(l+f+"/"+h);n(v,a)}v._ojLocale_=p.join("-"),u(v)})}))}}})}(),define("pcs/taskhistory/viewModel/taskHistoryVM",["ojs/ojcore","knockout","jquery","pcs/util/pcsUtil","pcs/taskhistory/viewModel/TaskHistory","ojs/ojknockout","ojs/ojcollapsible","ojL10n!pcsMsg/nls/pcsSnippetsResource","ojs/ojvalidation"],function(e,t,n,r,i){"use strict";function s(n){function o(){var e=new i,t=n.data.taskNumber;e.fetchTask(t).then(function(t){var n=t.processId,r=t.number;n!=null&&e.fetchProcessAuditInfo(n,r).then(function(e){s.buildTaskHistoryViewJSON(t,e)})})}function u(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.setRequestHeader("Authorization",r.getAuthInfo()),n.setRequestHeader("pcs_mode","dev"),n.responseType="blob",n.onreadystatechange=function(){n.status===200&&n.readyState===4&&t&&t(n.response)},n.send(null)}var s=this;s.procHistData=t.observableArray([]),s.bundle=require("ojL10n!pcsMsg/nls/pcsSnippetsResource"),o(),s.onAttachmentClick=function(e,t){var n=t.target.value,r=t.target.text;u(n,function(e){var t=URL.createObjectURL(e),n=document.createElement("a");n.style="display: none",n.href=t,n.download=r,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(t)})},s.buildTaskHistoryViewJSON=function(t,n){var r=t.number;t.rootTaskNumber&&(r=t.rootTaskNumber);var i=n,o={};o.taskNumber=r,o.history=[];if(i.processHistory)for(var u=0;u<i.processHistory.length;u++){var a={};a.activityType=i.processHistory[u].activityType;if(i.processHistory[u].activityType==="START_EVENT"){var f=s.bundle.pcs.taskHistory.proc_inst_started;f=e.Translations.applyParameters(f,{0:i.processHistory[u].processName}),a.creationDate=s.formatTaskHistoryDate(i.processHistory[u].creationDate,"MMM d, yyyy hh:mm:ss a");if(i.processHistory[u].updatedBy){var l=s.bundle.pcs.taskHistory.proc_inst_started_by;l=e.Translations.applyParameters(l,{0:i.processHistory[u].processName,1:i.processHistory[u].updatedBy}),f=l}a.displayMessage=f}i.processHistory[u].activityType==="END_EVENT"&&(a.displayMessage=s.bundle.pcs.taskHistory.proc_inst_ended,a.creationDate=s.formatTaskHistoryDate(i.processHistory[u].creationDate,"MMM d, yyyy hh:mm:ss a"));if(i.processHistory[u].activityType==="FUTURE_TASK"){var c=s.bundle.pcs.taskHistory.pcs_history_user_task_pending;c=e.Translations.applyParameters(c,{0:i.processHistory[u].activityName}),a.displayMessage=c}if(i.processHistory[u].activityType==="USER_TASK"){var h;i.processHistory[u].userTaskTitle?h=i.processHistory[u].userTaskTitle:h=i.processHistory[u].activityName,a.displayMessage=h,a.creationDate=s.formatTaskHistoryDate(i.processHistory[u].creationDate,"MMM d, yyyy hh:mm:ss a"),a.showExpanded="false";if(r==i.processHistory[u].userTaskNumber){a.detailedHistory=[],a.showExpanded="true";var p=t.routingType;p==="SINGLE"?(a.routingTypeImageClass="pcs-th-single-assignee-img",a.routingTypeImageTitle="Single Assignee"):p==="PARALLEL"?(a.routingTypeImageClass="pcs-th-parallel-assignee-img",a.routingTypeImageTitle="Parallel Assignees",a.routingTypeMoreInfo="Consensus : "+t.outcomePercentage+" %"):p==="SEQUENTIAL"?(a.routingTypeImageClass="pcs-th-sequential-assignee-img",a.routingTypeImageTitle="Sequential Assignees"):p==="MANAGEMENT CHAIN"&&(a.routingTypeImageClass="pcs-th-management-chain-assignee-img",a.routingTypeImageTitle="Management Chain in Sequence",a.routingTypeMoreInfo="Number of levels : "+t.managementChainLevel),a.originalAssignees=[];for(var d=0;d<t.originalAssignees.items.length;d++){var v={};v.type=t.originalAssignees.items[d].type,v.id=t.originalAssignees.items[d].id;var m=t.originalAssignees.items[d].type;m==="user"?v.assigneeTypeImageClass="pcs-th-history-user-img":m==="group"?v.assigneeTypeImageClass="pcs-th-history-group-img":m==="application_role"&&(v.assigneeTypeImageClass="pcs-th-history-approle-img"),a.originalAssignees.push(v)}for(var g=0;g<i.processHistory[u].taskHistory.length;g++){var y={};if(i.processHistory[u].taskHistory[g].actionName==="System Update")continue;if(i.processHistory[u].taskHistory[g].actionName==="Withdrawn"){var b=s.bundle.pcs.taskHistory.pcs_history_withdrawn_message;b=e.Translations.applyParameters(b,{0:i.processHistory[u].taskHistory[g].displayName}),y.displayMessage=b,y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-withdrawn-action-img",y.actionType="REGULAR"}else if(i.processHistory[u].taskHistory[g].actionName==="Resumed"){var w=s.bundle.pcs.taskHistory.pcs_history_resumed_message;w=e.Translations.applyParameters(w,{0:i.processHistory[u].taskHistory[g].displayName}),y.displayMessage=w,y.actionType="REGULAR",y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-resumed-action-img"}else if(i.processHistory[u].taskHistory[g].actionName==="Suspended"){var E=s.bundle.pcs.taskHistory.pcs_history_suspended_message;E=e.Translations.applyParameters(E,{0:i.processHistory[u].taskHistory[g].displayName}),y.displayMessage=E,y.actionType="REGULAR",y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-suspended-action-img"}else if(i.processHistory[u].taskHistory[g].actionName==="Escalated"){var S=s.bundle.pcs.taskHistory.pcs_history_escalated_message;S=e.Translations.applyParameters(S,{0:i.processHistory[u].taskHistory[g].displayName}),y.displayMessage=S,y.actionType="REGULAR",y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-escalated-action-img"}else if(i.processHistory[u].taskHistory[g].actionName==="Delegated"){var x=s.bundle.pcs.taskHistory.pcs_history_delegated_message;x=e.Translations.applyParameters(x,{0:i.processHistory[u].taskHistory[g].displayName}),y.displayMessage=x,y.actionType="REGULAR",y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-delegated-action-img"}else if(i.processHistory[u].taskHistory[g].actionName==="Approved"){var T=s.bundle.pcs.taskHistory.pcs_history_approved_message;T=e.Translations.applyParameters(T,{0:i.processHistory[u].taskHistory[g].displayName}),y.displayMessage=T,y.actionType="REGULAR",y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-approved-action-img"}else if(i.processHistory[u].taskHistory[g].actionName==="Rejected"){var N=s.bundle.pcs.taskHistory.pcs_history_rejected_message;N=e.Translations.applyParameters(N,{0:i.processHistory[u].taskHistory[g].displayName}),y.displayMessage=N,y.actionType="REGULAR",y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-rejected-action-img"}else if(i.processHistory[u].taskHistory[g].actionName.toString().startsWith("Task Completed")){var C=i.processHistory[u].taskHistory[g].actionName.toString(),k=C.split("-"),L=k[1].trim(),A={};if(i.processHistory[u].taskHistory[g].displayName){L==="Rejected"?A.imageClass="pcs-th-rejected-action-img":L==="Approved"?A.imageClass="pcs-th-approved-action-img":A.imageClass="pcs-th-undefined-action-img";var O=s.bundle.pcs.taskHistory.pcs_history_any_action_message;O=e.Translations.applyParameters(O,{0:L,1:i.processHistory[u].taskHistory[g].displayName}),A.displayMessage=O,A.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),A.actionType="REGULAR",a.detailedHistory.push(A)}var M=s.bundle.pcs.taskHistory.pcs_history_task_completed;y.displayMessage=M,y.actionType="REGULAR",y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-task-Completed-action-img"}else if(i.processHistory[u].taskHistory[g].actionName==="Information Submitted"){var _=s.bundle.pcs.taskHistory.pcs_history_info_submitted_message;_=e.Translations.applyParameters(_,{0:i.processHistory[u].taskHistory[g].displayName,1:i.processHistory[u].taskHistory[g].infoSubmittedTo}),y.displayMessage=_,y.actionType="REGULAR",y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-info-submitted-action-img"}else if(i.processHistory[u].taskHistory[g].actionName==="Task Updated"){if(i.processHistory[u].taskHistory[g].displayName){var D=s.bundle.pcs.taskHistory.pcs_history_task_updated_message;D=e.Translations.applyParameters(D,{0:i.processHistory[u].taskHistory[g].displayName}),y.displayMessage=D,y.actionType="REGULAR",y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-task-updated-action-img"}}else if(i.processHistory[u].taskHistory[g].actionName==="Information Requested"){var P=s.bundle.pcs.taskHistory.pcs_history_info_requested_message,H=i.processHistory[u].taskHistory[g].infoRequestedFrom;P=e.Translations.applyParameters(P,{0:i.processHistory[u].taskHistory[g].displayName,1:H}),y.displayMessage=P,y.actionType="REGULAR",y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-info-requested-action-img"}else if(i.processHistory[u].taskHistory[g].actionName==="Reassigned"){var B=s.bundle.pcs.taskHistory.pcs_history_reassigned_message;B=e.Translations.applyParameters(B,{0:i.processHistory[u].taskHistory[g].displayName}),y.displayMessage=B,y.actionType="REGULAR",y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-reassigned-action-img"}else if(i.processHistory[u].taskHistory[g].actionName==="Assigned"){var j=s.bundle.pcs.taskHistory.pcs_history_assigned_message;j=e.Translations.applyParameters(j,{0:i.processHistory[u].taskHistory[g].displayName}),y.displayMessage=j,y.actionType="REGULAR",y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-assigned-action-img"}else if(i.processHistory[u].taskHistory[g].actionName==="Attachment Added"){var F=s.bundle.pcs.taskHistory.pcs_history_doc_attached_message;F=e.Translations.applyParameters(F,{0:i.processHistory[u].taskHistory[g].displayName}),y.displayMessage=F,y.attachmentName=i.processHistory[u].taskHistory[g].reason,y.actionType="ATTACHMENT_ADDED",y.attachmentURL=i.processHistory[u].taskHistory[g].attachmentUri.href+"/stream",y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-att-added-action-img"}else if(i.processHistory[u].taskHistory[g].actionName==="Attachment Removed"){var I=s.bundle.pcs.taskHistory.pcs_history_doc_removed_message;I=e.Translations.applyParameters(I,{0:i.processHistory[u].taskHistory[g].displayName}),y.displayMessage=I,y.actionType="REGULAR",y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-att-removed-action-img"}else if(i.processHistory[u].taskHistory[g].actionName==="Comment Added"){var q=s.bundle.pcs.taskHistory.pcs_history_commented_message;q=e.Translations.applyParameters(q,{0:i.processHistory[u].taskHistory[g].displayName}),y.displayMessage=q,y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-comment-added-action-img",y.comments=""+i.processHistory[u].taskHistory[g].reason+"",y.actionType="COMMENT_ADDED"}else{var R=s.bundle.pcs.taskHistory.pcs_history_resumed_message;R=e.Translations.applyParameters(R,{0:i.processHistory[u].taskHistory[g].displayName}),y.displayMessage=R;var U=i.processHistory[u].taskHistory[g].actionName;y.displayMessage=U+" by "+i.processHistory[u].taskHistory[g].displayName,y.creationDate=s.formatTaskHistoryDate(i.processHistory[u].taskHistory[g].updatedDate,"MMM d, yyyy hh:mm:ss a"),y.imageClass="pcs-th-custom-action-img",y.actionType="REGULAR"}a.detailedHistory.push(y)}}}o.history.push(a)}s.procHistData(o.history),console.log(o)},s.formatTaskHistoryDate=function(n,r){var i={formatType:"date",pattern:r},s=e.Validation.converterFactory("datetime").createConverter(i);return s.format(e.IntlConverterUtils.dateToLocalIso(new Date(n)))},s.dispose=function(){console.log("dispose in taskHistoryVm")}}return s}),define("pcs/pcs.taskhistory",["ojs/ojcore","knockout","jquery","text!pcs/taskhistory/templates/pcs-task-history-container.html","pcs/taskhistory/viewModel/taskHistoryVM","ojL10n!pcsMsg/nls/pcsSnippetsResource","jqueryui-amd/widget"],function(e,t,n,r,i){"use strict";n.widget("pcs.taskhistory",{options:{taskNumber:""},_create:function(){var e=this,n=this.options;n.rootElement=e.element;var s={data:n};this.element.html(r);var o=new i(s);this.model=o,t.applyBindings(o,this.element[0])},destroy:function(){n.Widget.prototype.destroy.call(this)},_destroy:function(){console.log("Destroying history"),this.model&&this.model.dispose()},_setOption:function(e,t){this.options[e]=t,n.Widget.prototype._setOption.apply(this,arguments)}})});